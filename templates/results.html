{% extends "layout.html" %}

{% block title %}
  How much is a vote in {{ constituency }} worth?
{% endblock %}

{% block opengraph %}
<meta property="fb:app_id"          content="426164098090519" />
<meta property="og:type"            content="website" />
<meta property="og:url"             content="http://www.voterpower.co.uk/" />
<meta property="og:title"           content="A vote in {{constituency}} is worth only {{voter_index}} votes" />
<meta property="og:image"           content="https://upload.wikimedia.org/wikipedia/commons/c/c9/Polling_Station_2008.jpg" />
<meta property="og:description"    content="Under first past the post, not all votes are equal. Find out what your vote is worth and how we can fix this." />
{% endblock %}

{% block sharing %}
<script src="https://kit.fontawesome.com/27bd1a8967.js" crossorigin="anonymous"></script>
{% endblock %}

{% block script %}
<script src="https://cdnjs.cloudflare.com/ajax/libs/raphael/2.1.1/raphael-min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/justgage/1.3.1/justgage.min.js"></script>

<!-- Google Donut Chart - Recommends script goes in <head> -->
<script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>

<script type="text/javascript">
  var resultsData = [
    ['Party', '% of Vote'],
    ['Conservatives', {{results_dict['Conservative']}}],
    ['Labour', {{results_dict['Labour']}}],
    ['Liberal Democrats', {{results_dict['Lib Dem']}}],
    ['SNP', {{results_dict['Scottish National Party']}}],
    ['Plaid Cymru', {{results_dict['Plaid Cymru']}}],
    ['Green Party', {{results_dict['Green']}}],
    ['UKIP', {{results_dict['UKIP']}}],
    ['Independents', {{results_dict['Independent']}}]

  ]

  var resultsOptions = {
    title: '2017 General Election',
    sliceVisibilityThreshold: 0.05,
    pieSliceTextStyle: {
      color: 'white',
    },
    colors: ['#0087dc', '#d50000', '#FDBB30', '#FFF95D', '#3F8428', '#008066', '#B3009D', '#e8e8e1']
  };

  var resultsElement = "resultsChart"


  var wastedData = [
    ['Party', '% of Vote'],
    ['Necessary votes for winner', {{second_placed_votes}}],
    ['Wasted votes for winner', {{surplus_votes}}],
    ['Votes for losers', {{non_winner_votes}}]

  ]

  var wastedOptions = {
    title: 'Wasted Votes',
    sliceVisibilityThreshold: 0,
    pieSliceTextStyle: {
      color: 'white',
    },
    colors: ['green', '#595959', '#000000']
  };

  var wastedElement = "wastedChart"

  google.charts.load("current", {packages:["corechart"]});
  google.charts.setOnLoadCallback(function() {
    drawChart(resultsData, resultsOptions, resultsElement)});
  google.charts.setOnLoadCallback(function() {
    drawChart(wastedData, wastedOptions, wastedElement)});

  function drawChart(data, options, element) {

    data = google.visualization.arrayToDataTable(data)

    var chart = new google.visualization.PieChart(document.getElementById(element));
    chart.draw(data, options);
  }

  var gaugeGraph = new JustGage({
    id: "gauge",
    value: {{voter_index}},
    min: 0,
    max: 1.68,
    title: "Voter Power",
    formatNumber: true,
    pointer: true,
    pointerOptions: {
      toplength: -15,
      bottomlength: 10,
      bottomwidth: 12,
      color: '#8e8e93',
      stroke: '#ffffff',
      stroke_width: 3,
      stroke_linecap: 'round'
    },
    gaugeWidthScale: 0.6,
    customSectors: {
        percents: true,
        ranges: [{
          color : "#ff0000",
          lo : 0,
          hi : 20
        },{
          color : "#ff6f00",
          lo : 20.1,
          hi : 40
        },{
          color : "#ff6f00",
          lo : 40.1,
          hi : 60
        },{
          color : "#9dff00",
          lo : 60.1,
          hi : 80
        },{
          color : "#00b30c",
          lo : 80.1,
          hi : 100
        }]
      }
  });

</script>
{% endblock %}

{% block content %}

            <div class="row justify-content-center">
              <div class="col">
                <form action="{{ url_for('postcode_search') }}" method="POST">
                    <div class="row p-3">
                        <div class="col-9">
                            <div class="form-group"><input class="form-control" placeholder="Enter your postcode" type="text" name="postcode" required /></div>
                        </div>
                        <div class="col-3">
                            <div class="form-group"><button class="btn btn-primary border rounded" type="submit">Go</button></div>
                        </div>
                    </div>
                </form>
              </div>
            </div>


            <div class="row justify-content-center pb-2">
              <div class="col text-center">
                  <h6>Share your voter power</h6>
                  <div id=sharingButtons class="">

                      <a class="facebook-share-button" target="_blank" href="https://www.facebook.com/share.php?u=https%3A%2F%2Fwww.voterpower.co.uk&quote=My+vote+is+worth+only+{{voter_index}}+votes.+What%27s+yours+worth%3F">
                      <i class="fab fa-facebook-square fa-3x"></i></a>


                      <a class="twitter-share-button" target="_blank" href="https://twitter.com/intent/tweet?text=My+vote+is+worth+only+{{voter_index}}+votes.+What%27s+yours+worth%3F+https%3A%2F%2Fwww.voterpower.co.uk">
                      <i class="fab fa-twitter-square fa-3x"></i></a>

                      <a href="https://www.reddit.com/submit?url=https://www.voterpower.co.uk/{{constituency_encode}}&title=My+vote+is+worth+only+{{voter_index}}+votes.+What%27s+yours+worth%3F" target="_blank" >
                      <i class="fab fa-reddit-square fa-3x"></i></a>

                      <a href="whatsapp://send?text=My vote is worth only {{voter_index}} votes. What's yours worth? https://www.voterpower.co.uk/{{constituency_encode}}" data-action="share/whatsapp/share" target="_blank" >
                        <i class="fab fa-whatsapp-square fa-3x"></i></a>
                  </div>
              </div>
            </div>
              <div class="row">
                <div class="col">
                  <h1 class="text-center">In {{constituency}}, each person&#39;s vote is worth the equivalent of {{voter_index}} votes</h1>
                </div>
              </div>
                    <div class="row">
                        <div class="col-sm-3" id="gauge">
                        </div>
                        <div class="col-sm-9">
                          <div class="lead mt-3">
                            Voters in {{constituency}} have {{power_comparison_text}} voting power than the average UK voter.
                          </div>
                          <p class="lead">
                            {{constituency}} ranks {{ranking}} out of 650 constituencies in the UK
                          </p>

                        </div>
                    </div>
                    <hr />
                    <div class="row">
                        <div class="col">
                            <h4>{{total_wasted_votes}} votes were wasted in {{constituency}} in 2017:</h4>
                            <ul>
                                <li class="text-left">{{non_winner_votes}} people did not vote for the winning candidate. Their votes were wasted, as they could not be used to help their preferred party in another constituency.</li>
                                <li class="text-left">The winning {{winning_party}} candidate only needed {{second_placed_votes}} votes to beat the second-placed {{second_placed_party}} candidate, so the {{surplus_votes}} votes they received above this were wasted, as they could not be used to help {{winning_party}} candidates in other constituencies.</li>
                            </ul>
                        </div>
                      </div>
                        <div class="row">

                        <div class="col-sm-3 justify-content-center" id="resultsChart"></div>
                        <div class="col-sm-3 justify-content-center" id="wastedChart"></div>
                      </div>


                    <div class="row pb-3">
                        <div class="col">
                            <h4>It doesn&#39;t have to be like this</h4>
                            <p>Under a proportional electoral system, every vote can count. There are many systems available and they are widely used in other countries, in Scotland, Wales, Northern Ireland and London. They're even used for internal elections in the House of Commons. So why can't every vote count when we elect MPs?</p>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col">
                            <h4>What do the parties say about electoral reform? (based on 2017 manifestos)</h4>
                            <ul>
                                <li class="text-danger"><b>Conservatives</b> &quot;We will retain the first past the post system for voting for parliamentary elections&quot;</li>
                                <li class="text-danger"><b>Labour</b> No specific policy</li>
                                <li class="text-success"><b>Liberal Democrats</b> &quot;Introduce the Single Transferable Vote for local government elections in England and for electing MPs across the UK.&quot;</li>
                                <li class="text-success"><b>Green Party</b> &quot;Introduce proportional representation (PR) for parliamentary and local elections&quot;</li>
                                <li class="text-success"><b>Brexit Party</b> No 2017 manifesto, but supports a proportional system for electing MPs</li>
                                <li class="text-success"><b>Scottish National Party</b>Â &quot;We support the replacement of the first-past-the-post system with proportional representation for elections to the House of Commons.&quot;</li>
                                <li class="text-success"><b>Plaid Cymru</b> &quot;...reform the voting system so that it is more representative.&quot;</li>
                            </ul>
                        </div>
                    </div>

                    <div class="row justify-content-center">

                    <div class="col-sm-3">
                      <h5>Top 5 Constituencies</h5>
                      <ol>
                        {% for constituency in top_five %}
                        <li>
                          <a href="{{constituency[0]}}">{{constituency[0]}} ({{constituency[1]}})</a>
                        </li>
                        {% endfor %}
                      </ol>
                    </div>
                    <div class="col-sm-3">
                      <h5>Bottom 5 Constituencies</h5>
                      <ol>
                        {% for constituency in bottom_five %}
                        <li>
                          <a href="{{constituency[0]}}">{{constituency[0]}} ({{constituency[1]}})</a>
                        </li>
                        {% endfor %}
                      </ol>
                    </div>
                    </div>


    <footer>
      <div class="row">
        <div class="col">
          <hr />
          <small>
            <p>
              The Voter Power Index is based on research by the New Economics Foundation. <a href="http://m.voterpower.org.uk/files/voter_power_index.pdf" target=_blank>Read about their research here.</a>
            </p>
            <p>
              This website was heavily inspired by (i.e. is a complete rip-off of) Martin Petts&#39; excellent, but sadly now outdated, <a href="http://www.voterpower.org.uk" target=_blank>voterpower.org.uk</a> website, created for the 2015 general election. All credit should go to him.
            </p>
            <p>
              This version of the Voter Power Index website was created by two private UK citizens, Tim and Rob, as a coding project. We both believe that a healthy democracy is one in which every vote counts and encourages compromise to be found. The website is not affiliated with any political party, movement or campaign.
            </p>
            <p>
              Would you like to help develop voterpower.co.uk? If so, check out the code on <a href="https://github.com/robcowen/voterpower" target="_blank">Github</a> and contribute to this open source project.
            </p>
            </small>
        </div>
      </div>
    </footer>
</main>

{% endblock %}
